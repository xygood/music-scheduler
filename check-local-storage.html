<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>检查本地存储</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        .data-section {
            margin-top: 20px;
        }
        .data-section h2 {
            color: #555;
            margin-bottom: 10px;
        }
        pre {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            border: 1px solid #ddd;
        }
        .info {
            color: #666;
            margin-top: 10px;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>检查本地存储中的禁排时段数据</h1>
        
        <div class="data-section">
            <h2>禁排时段数据</h2>
            <pre id="blockedSlotsData">加载中...</pre>
        </div>
        
        <div class="data-section">
            <h2>学期标签</h2>
            <pre id="semesterLabel">加载中...</pre>
        </div>
        
        <div class="data-section">
            <h2>操作</h2>
            <button onclick="loadData()">重新加载数据</button>
            <button onclick="clearBlockedSlots()">清空禁排时段</button>
        </div>
        
        <div class="info">
            <p>注意：此页面用于检查本地存储中的禁排时段数据。如果数据显示为空，请检查周次配置页面是否正确添加了禁排时段。</p>
        </div>
    </div>
    
    <script>
        function loadData() {
            try {
                // 加载禁排时段数据
                const blockedSlots = JSON.parse(localStorage.getItem('music_scheduler_blocked_slots') || '[]');
                document.getElementById('blockedSlotsData').textContent = JSON.stringify(blockedSlots, null, 2);
                
                // 计算当前学期标签
                const getCurrentAcademicYear = () => {
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = now.getMonth() + 1;
                    if (month >= 8) {
                        return `${year}-${year + 1}`;
                    } else {
                        return `${year - 1}-${year}`;
                    }
                };
                
                const getCurrentSemesterLabel = () => {
                    const now = new Date();
                    const month = now.getMonth() + 1;
                    const academicYear = getCurrentAcademicYear();
                    const semester = month >= 8 ? '1' : '2';
                    return `${academicYear}-${semester}`;
                };
                
                const currentSemesterLabel = getCurrentSemesterLabel();
                document.getElementById('semesterLabel').textContent = currentSemesterLabel;
                
                // 检查第10周的禁排时段
                const week10Slots = blockedSlots.filter(slot => {
                    if (slot.week_number === 10) return true;
                    if (slot.specific_week_days) {
                        return slot.specific_week_days.some(wd => wd.week === 10);
                    }
                    return false;
                });
                
                console.log('禁排时段数据:', blockedSlots);
                console.log('当前学期标签:', currentSemesterLabel);
                console.log('第10周的禁排时段:', week10Slots);
            } catch (error) {
                document.getElementById('blockedSlotsData').textContent = '错误：' + error.message;
                document.getElementById('blockedSlotsData').classList.add('error');
            }
        }
        
        function clearBlockedSlots() {
            if (confirm('确定要清空所有禁排时段数据吗？')) {
                localStorage.removeItem('music_scheduler_blocked_slots');
                loadData();
                alert('禁排时段数据已清空');
            }
        }
        
        // 页面加载时自动加载数据
        window.onload = loadData;
    </script>
</body>
</html>